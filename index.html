<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <title>Js0xff – Universal Protector</title>
    <script src="protected-styles.js"></script>
</head>
<body>
    <div class="container">
        <h1>{Advanced Js & Css Obfuscator}</h1>

        <!-- DOMAIN LOCK UI -->
        <div id="domainLockBox" class="domain-lock-box">
            <label class="switch-label">
                <span>Lock to my domain</span>
                <span class="switch">
                    <input type="checkbox" id="domainLockSwitch">
                    <span class="slider"></span>
                </span>
            </label>
            <input id="domainInput"
                   class="domain-input"
                   placeholder="example.com  (no http/www)">
        </div>

        <div id="codeEditor" class="code-editor" placeholder="Enter your code (JS/CSS/HTML) here..."></div>

        <div class="status" id="statusMessage">Ready to obfuscate / protect your code.</div>

        <div class="button-container">
            <button onclick="obfuscateCode()">//Protect Code//</button>
            <button onclick="copyToClipboard()">//Copy Output//</button>
            <button onclick="downloadCode()">//Download Code//</button>
            <button onclick="document.getElementById('fileInput').click()">//Upload File//</button>
            <button onclick="clearCode()">//Clear Code//</button>
        </div>
        <input type="file" id="fileInput" onchange="handleFileUpload(event)">

        <div class="footer">
          Developed by <a href="https://sujon0xff.github.io/" target="_blank">Sujon Islam</a>
           | Join our <a href="https://t.me/Freedom369_4u" target="_blank">Telegram</a>
        </div>
    </div>
<a href="chatai.html" class="floating-message-button">
  <i class="fas fa-comment"></i>
</a>
    <script src="https://cdn.jsdelivr.net/npm/javascript-obfuscator@2.11.0/dist/index.browser.js"></script>
<script src="https://cdn.rawgit.com/ajaxorg/ace-builds/master/src-noconflict/ace.js" charset="utf-8"></script>
<script>
let editor;
const domainLockBox  = document.getElementById('domainLockBox');
const domainSwitch   = document.getElementById('domainLockSwitch');
const domainInput    = document.getElementById('domainInput');
const fileInput      = document.getElementById('fileInput');

window.addEventListener('load', () => {
    // Ace editor init
    editor = ace.edit("codeEditor");
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/javascript");
    editor.setOptions({
        wrap: true,
        tabSize: 4,
        fontSize: '14px',
        showGutter: true,
        highlightActiveLine: true,
        autoScrollEditorIntoView: true,
    });

    // restore saved code and domain settings from localStorage
    const savedCode = localStorage.getItem("savedCode");
    if (savedCode) {
        editor.setValue(savedCode, -1);
    }
    const savedDomain = localStorage.getItem("savedDomain");
    if (savedDomain) {
        domainInput.value = savedDomain;
    }
    const savedDomainLock = localStorage.getItem("savedDomainLock");
    if (savedDomainLock === "true") {
        domainSwitch.checked = true;
        domainInput.style.display = 'block';
    } else {
        domainSwitch.checked = false;
        domainInput.style.display = 'none';
    }

    // show UI animation
    setTimeout(() => {
        document.body.style.opacity = '1';
        document.querySelector('.container').style.opacity = '1';
        document.querySelector('.container').style.transform = 'translateY(0)';
        document.querySelector('h1').style.opacity = '1';
        document.querySelector('h1').style.transform = 'translateY(0)';
        document.querySelector('.ace_editor').style.opacity = '1';
        document.querySelector('.ace_editor').style.transform = 'scale(1)';
        document.querySelector('.status').style.opacity = '1';
        document.querySelector('.button-container').style.opacity = '1';
        document.querySelector('.button-container').style.transform = 'translateY(0)';
        document.querySelector('.footer').style.opacity = '1';
        domainLockBox.classList.add('show');
    }, 500);

    // save code automatically on change & detect type
    editor.session.on('change', () => {
        try {
            localStorage.setItem("savedCode", editor.getValue());
        } catch(e){}
        detectContentType();
    });

    // domain switch onchange (persist state)
    domainSwitch.onchange = () => {
        domainInput.style.display = domainSwitch.checked ? 'block' : 'none';
        localStorage.setItem("savedDomainLock", domainSwitch.checked ? "true" : "false");
    };

    // normalize domain input on-the-fly
    domainInput.addEventListener("input", () => {
        let val = domainInput.value || '';
        // lowercase and strip protocol, www and trailing slashes and spaces
        val = val.trim().toLowerCase()
            .replace(/https?:\/\//i, "")
            .replace(/^www\./i, "")
            .replace(/\/+$/,"")
            .replace(/\s+/g, "");
        domainInput.value = val;
        // save live
        localStorage.setItem("savedDomain", domainInput.value);
    });

    // init detect (in case loaded code is present)
    detectContentType();
});

// ---------- DETECT CONTENT ----------
function detectContentType() {
    const txt = editor.getValue().trim();
    if (!txt) {
        editor.session.setMode("ace/mode/javascript");
        domainInput.style.display = domainSwitch.checked ? 'block' : 'none';
        return;
    }

    const cleanCode = txt
        .replace(/\/\*[\s\S]*?\*\//g, '')
        .replace(/\/\/.*$/gm, '')
        .replace(/(['"`])((?:(?!\1)[^\\]|\\.)*)(\1)/g, '');

    let htmlScore = 0;
    let cssScore = 0;
    let jsScore = 0;

    // HTML Detection
    if (/<html\b/i.test(cleanCode)) htmlScore += 10;
    if (/<body\b/i.test(cleanCode)) htmlScore += 8;
    if (/<head\b/i.test(cleanCode)) htmlScore += 6;
    if (/<script\b[^>]*>(?!\s*<\/script>)/i.test(cleanCode)) htmlScore += 7;
    if (/<style\b[^>]*>(?!\s*<\/style>)/i.test(cleanCode)) htmlScore += 5;
    if (/<div\b|<span\b|<p\b|<h[1-6]\b/i.test(cleanCode)) htmlScore += 3;
    if (/<[^>]+>/g.test(cleanCode)) htmlScore += 2; // General tag detection
    if (/<title\b/i.test(cleanCode)) htmlScore += 4;
    if (/<meta\b/i.test(cleanCode)) htmlScore += 4;
    if (/<link\b/i.test(cleanCode)) htmlScore += 4;
    if (/<img\b|<a\b|<table\b/i.test(cleanCode)) htmlScore += 2;

    // CSS Detection
    if (/@import\b|@media\b|@keyframes\b|@font-face\b|@supports\b/i.test(cleanCode)) cssScore += 10;
    if (/^[^{]*\{[^}]*\}/m.test(cleanCode)) cssScore += 8;
    const cssBlocks = cleanCode.match(/^[^\n{]*\{[\s\S]*?\}/gm) || [];
    cssScore += Math.min(cssBlocks.length * 2, 12);
    if (/\b(color|background|margin|padding|display|position|width|height|font|text|border|outline|box-shadow|transform|transition|animation)\s*:/i.test(cleanCode)) cssScore += 5;
    if (/\b(top|left|right|bottom|z-index|opacity|visibility|cursor|overflow|float|clear|display:flex|grid)\s*:/i.test(cleanCode)) cssScore += 4;
    if (/\b(url\(|rgba?\(|hsla?\(|calc\(|var\(--)/i.test(cleanCode)) cssScore += 3;
    if (/::?[\w-]+/g.test(cleanCode)) cssScore += 2; // Pseudo-selectors
    if (/#\w+\s*\{|\.[\w-]+\s*\{/g.test(cleanCode)) cssScore += 3; // ID/class selectors

    // JavaScript Detection
    if (/(function\s+\w+|const\s+\w+|let\s+\w+|var\s+\w+|=>|class\s+\w+)/i.test(cleanCode)) jsScore += 10;
    if (/(if\s*\(|for\s*\(|while\s*\(|switch\s*\(|try\s*\{|catch\s*\(|finally\s*\{|do\s*\{|else\s*\{)/i.test(cleanCode)) jsScore += 8;
    if (/\b(return|break|continue|throw|new\s+\w+|typeof|instanceof|delete|void)\b/i.test(cleanCode)) jsScore += 7;
    if (/\b(document|window|console|navigator|location|history|localStorage|sessionStorage|alert|confirm|prompt|setTimeout|setInterval|clearTimeout|clearInterval|fetch|XMLHttpRequest|Promise|async|await|addEventListener|removeEventListener)\b/i.test(cleanCode)) jsScore += 6;
    if (/\bexport\b|\bimport\b\s+.*from|\bfrom\s+'|from\s+"/i.test(cleanCode)) jsScore += 12;
    if (/\[(?:[^[\]]|\[[^\]]*\])*\]/g.test(cleanCode)) jsScore += 2; // Array detection
    if (/\{(?:[^{}]|{[^}]*})*\}/g.test(cleanCode) && !cssBlocks.length) jsScore += 2; // Object detection
    if (/\b(Math\.|Date\.|JSON\.|Array\.|String\.|Number\.|Boolean\.|RegExp\.|Error\.|Symbol\.|BigInt\.)/i.test(cleanCode)) jsScore += 3;
    if (/\b(this|super|yield|debugger)\b/i.test(cleanCode)) jsScore += 4;

    // Context-based adjustments
    const hasHtmlTag = /<\/?[a-z][a-z0-9]*(\s[^>]*)?>/i.test(cleanCode);
    const hasJsKeyword = /(function|var|let|const|=>|return|if\s*\(|for\s*\(|while\s*\(|switch\s*\(|try|catch|finally|do|else|class|import|export)/i.test(cleanCode);
    
    if (!hasHtmlTag && !hasJsKeyword && cssScore > 0) {
        cssScore += 15; // Likely pure CSS
    }
    
    if (hasHtmlTag && hasJsKeyword && jsScore > 0) {
        jsScore += 5; // Likely HTML with JS
    }

    // Calculate final scores
    const maxScore = Math.max(htmlScore, cssScore, jsScore);
    let isHTML = false, isCSS = false, isJS = false;

    if (maxScore === cssScore && cssScore >= 8) {
        isCSS = true;
    } else if (maxScore === htmlScore && htmlScore >= 6) {
        isHTML = true;
    } else {
        isJS = true;
    }

    // set ace mode
    if (isCSS) {
        editor.session.setMode("ace/mode/css");
    } else if (isHTML) {
        editor.session.setMode("ace/mode/html");
    } else {
        editor.session.setMode("ace/mode/javascript");
    }

    domainInput.style.display = domainSwitch.checked ? 'block' : 'none';
}

// ---------- OBFUSCATE ----------
function obfuscateCode() {
    const inputCode = editor.getValue().trim();
    if (!inputCode) {
        updateStatus('Please enter some code to protect!', 'warning');
        return;
    }

    // prevent re-obfuscation (simple heuristic)
    if (isObfuscated(inputCode)) {
        updateStatus('Code is already protected!', 'warning');
        return;
    }

    updateStatus('Protecting...', 'info');

    // detect type
    const txt = inputCode;
    const cleanCode = txt
        .replace(/\/\*[\s\S]*?\*\//g, '')
        .replace(/\/\/.*$/gm, '')
        .replace(/(['"`])((?:(?!\1)[^\\]|\\.)*)(\1)/g, '');

    let htmlScore = 0;
    let cssScore = 0;
    let jsScore = 0;

    // HTML Detection
    if (/<html\b/i.test(cleanCode)) htmlScore += 10;
    if (/<body\b/i.test(cleanCode)) htmlScore += 8;
    if (/<head\b/i.test(cleanCode)) htmlScore += 6;
    if (/<script\b[^>]*>(?!\s*<\/script>)/i.test(cleanCode)) htmlScore += 7;
    if (/<style\b[^>]*>(?!\s*<\/style>)/i.test(cleanCode)) htmlScore += 5;
    if (/<div\b|<span\b|<p\b|<h[1-6]\b/i.test(cleanCode)) htmlScore += 3;
    if (/<[^>]+>/g.test(cleanCode)) htmlScore += 2;
    if (/<title\b/i.test(cleanCode)) htmlScore += 4;
    if (/<meta\b/i.test(cleanCode)) htmlScore += 4;
    if (/<link\b/i.test(cleanCode)) htmlScore += 4;
    if (/<img\b|<a\b|<table\b/i.test(cleanCode)) htmlScore += 2;

    // CSS Detection
    if (/@import\b|@media\b|@keyframes\b|@font-face\b|@supports\b/i.test(cleanCode)) cssScore += 10;
    if (/^[^{]*\{[^}]*\}/m.test(cleanCode)) cssScore += 8;
    const cssBlocks = cleanCode.match(/^[^\n{]*\{[\s\S]*?\}/gm) || [];
    cssScore += Math.min(cssBlocks.length * 2, 12);
    if (/\b(color|background|margin|padding|display|position|width|height|font|text|border|outline|box-shadow|transform|transition|animation)\s*:/i.test(cleanCode)) cssScore += 5;
    if (/\b(top|left|right|bottom|z-index|opacity|visibility|cursor|overflow|float|clear|display:flex|grid)\s*:/i.test(cleanCode)) cssScore += 4;
    if (/\b(url\(|rgba?\(|hsla?\(|calc\(|var\(--)/i.test(cleanCode)) cssScore += 3;
    if (/::?[\w-]+/g.test(cleanCode)) cssScore += 2;
    if (/#\w+\s*\{|\.[\w-]+\s*\{/g.test(cleanCode)) cssScore += 3;

    // JavaScript Detection
    if (/(function\s+\w+|const\s+\w+|let\s+\w+|var\s+\w+|=>|class\s+\w+)/i.test(cleanCode)) jsScore += 10;
    if (/(if\s*\(|for\s*\(|while\s*\(|switch\s*\(|try\s*\{|catch\s*\(|finally\s*\{|do\s*\{|else\s*\{)/i.test(cleanCode)) jsScore += 8;
    if (/\b(return|break|continue|throw|new\s+\w+|typeof|instanceof|delete|void)\b/i.test(cleanCode)) jsScore += 7;
    if (/\b(document|window|console|navigator|location|history|localStorage|sessionStorage|alert|confirm|prompt|setTimeout|setInterval|clearTimeout|clearInterval|fetch|XMLHttpRequest|Promise|async|await|addEventListener|removeEventListener)\b/i.test(cleanCode)) jsScore += 6;
    if (/\bexport\b|\bimport\b\s+.*from|\bfrom\s+'|from\s+"/i.test(cleanCode)) jsScore += 12;
    if (/\[(?:[^[\]]|\[[^\]]*\])*\]/g.test(cleanCode)) jsScore += 2;
    if (/\{(?:[^{}]|{[^}]*})*\}/g.test(cleanCode) && !cssBlocks.length) jsScore += 2;
    if (/\b(Math\.|Date\.|JSON\.|Array\.|String\.|Number\.|Boolean\.|RegExp\.|Error\.|Symbol\.|BigInt\.)/i.test(cleanCode)) jsScore += 3;
    if (/\b(this|super|yield|debugger)\b/i.test(cleanCode)) jsScore += 4;

    const maxScore = Math.max(htmlScore, cssScore, jsScore);
    let isHTML = false, isCSS = false, isJS = false;

    if (maxScore === cssScore && cssScore >= 8) {
        isCSS = true;
    } else if (maxScore === htmlScore && htmlScore >= 6) {
        isHTML = true;
    } else {
        isJS = true;
    }

    // build domain lock snippet first
    let domainSnippet = '';
    if (domainSwitch.checked) { // Only if user enabled domain lock
        let domain = (domainInput.value || '').trim();

        // normalize: remove protocol, www, trailing slashes, lowercase
        domain = domain.toLowerCase()
            .replace(/https?:\/\//i,'')
            .replace(/^www\./i,'')
            .replace(/\/+$/,'')
            .replace(/\s+/g,'');

        // validate domain: simple but practical regex (ex: example.com, sub.example.co)
        const domainRegex = /^(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z]{2,}$/i;
        if (!domain || !domainRegex.test(domain)) {
            updateStatus('Please enter a valid domain like "example.com".', 'warning');
            return;
        }

        // save normalized domain
        domainInput.value = domain;
        try { localStorage.setItem("savedDomain", domain); } catch(e){}

        domainSnippet =
`var currentDomain=window.location.hostname;
var allowedDomain="${domain}";
if(currentDomain!==allowedDomain){window.location.href="https://${domain}/";}\n\n`;
    }

    let finalCode = '';

    if (isCSS) {
        // CSS + domain snippet + style injection
        finalCode = `${domainSnippet}const cssStyles=\`${inputCode.replace(/`/g,"\\`")}\`;
const styleElement=document.createElement("style");
styleElement.type="text/css";
styleElement.appendChild(document.createTextNode(cssStyles));
document.head.appendChild(styleElement);`;
    } else if (isHTML) {
        try {
            const parser = new DOMParser();
            const parsedDoc = parser.parseFromString(inputCode, 'text/html');

            const bodyHTMLRaw = parsedDoc.body ? parsedDoc.body.innerHTML : '';
            const styleNodes = Array.from(parsedDoc.querySelectorAll('style'));
            const stylesJoined = styleNodes.map(s => s.textContent).join("\n");
            const scriptNodes = Array.from(parsedDoc.querySelectorAll('script')).filter(s => !s.src);
            const inlineScriptsJoined = scriptNodes.map(s => s.textContent).join("\n;\n");

            // সঠিক কোড
const escapedBodyHTML = bodyHTMLRaw.replace(/\\/g, "\\\\").replace(/`/g, "\\`").replace(/\$\{/g, "\\${");
const escapedStyles = stylesJoined.replace(/\\/g, "\\\\").replace(/`/g, "\\`").replace(/\$\{/g, "\\${");
const escapedInlineScripts = inlineScriptsJoined.replace(/\\/g, "\\\\").replace(/`/g, "\\`").replace(/\$\{/g, "\\${");

            const runtime = `
(function(){
    try{
        var _styles = \`${escapedStyles}\`;
        if(_styles && _styles.trim().length){
            var styleElement = document.createElement('style');
            styleElement.type = 'text/css';
            styleElement.appendChild(document.createTextNode(_styles));
            var existing = false;
            var existingStyles = document.querySelectorAll('style');
            for(var i=0;i<existingStyles.length;i++){
                if(existingStyles[i].textContent.trim() === _styles.trim()){ existing = true; break; }
            }
            if(!existing) document.head.appendChild(styleElement);
        }

        var _bodyHTML = \`${escapedBodyHTML}\`;
        if(_bodyHTML && _bodyHTML.trim().length){
            var temp = document.createElement('div');
            temp.innerHTML = _bodyHTML;
            while(temp.firstElementChild){
                var child = temp.firstElementChild;
                var skip = false;
                if(child.id){
                    if(document.getElementById(child.id)) skip = true;
                }
                if(!skip && child.className){
                    var selector = child.tagName.toLowerCase() + '.' + child.className.split(/\\s+/).join('.');
                    if(document.querySelector(selector)) skip = true;
                }
                if(!skip){
                    document.body.appendChild(child);
                } else {
                    temp.removeChild(child);
                }
            }
        }

        var _inline = \`${escapedInlineScripts}\`;
        if(_inline && _inline.trim().length){
            try {
                var scriptEl = document.createElement('script');
                scriptEl.type = 'text/javascript';
                scriptEl.textContent = _inline;
                document.body.appendChild(scriptEl);
            } catch(se){
                try{ window.eval(_inline); }catch(e){ console.error('Script execution error', e); }
            }
        }
    }catch(e){
        try{ console.error('Injection error:', e); }catch(err){}
    }
})();`;

            finalCode = domainSnippet + runtime;
        } catch (err) {
            console.error('HTML parse error:', err);
            updateStatus('Failed to parse HTML for protection', 'error');
            return;
        }
    } else {
        // JS
        finalCode = domainSnippet + inputCode;
    }

    try {
        const obfuscationResult = JavaScriptObfuscator.obfuscate(finalCode, {
            compact: true,
            controlFlowFlattening: true,
            controlFlowFlatteningThreshold: 1.0,
            deadCodeInjection: true,
            deadCodeInjectionThreshold: 0.5,
            debugProtection: true,
            debugProtectionInterval: true,
            disableConsoleOutput: true,
            rotateStringArray: true,
            selfDefending: true,
            splitStrings: true,
            splitStringsChunkLength: 5,
            stringArray: true,
            stringArrayEncoding: ['base64', 'rc4'],
            stringArrayThreshold: 1.0,
            transformObjectKeys: true,
            unicodeEscapeSequence: true,
            identifierNamesGenerator: 'hexadecimal',
            ignoreRequireImports: true
        });
        editor.setValue(obfuscationResult.getObfuscatedCode(), -1);
        // update saved code to obfuscated version
        try { localStorage.setItem("savedCode", editor.getValue()); }catch(e){}
        updateStatus('Protection complete!', 'success');
    } catch (error) {
        console.error('Protection error:', error);
        updateStatus(`An error occurred: ${error.message}`, 'error');
    }
}

// ---------- Helpers ----------
function isObfuscated(code) {
    const patterns = [
        /_0x[a-f0-9]+/i,
        /eval\(function\(p,a,c,k,e,d\)/i,
        /var _0x[a-f0-9]+=\['[^']*'\]/i
    ];
    return patterns.some(p => p.test(code));
}

function copyToClipboard() {
    const code = editor.getValue();
    if (!code) {
        updateStatus('Nothing to copy', 'warning');
        return;
    }
    navigator.clipboard.writeText(code)
        .then(()=>updateStatus('Copied to clipboard!', 'success'))
        .catch(()=>updateStatus('Failed to copy', 'error'));
}

function downloadCode() {
    const code = editor.getValue();
    if (!code) {
        updateStatus('Nothing to download', 'warning');
        return;
    }

    // Detect the original content type before obfuscation
    const originalCode = localStorage.getItem("savedCode");
    if (originalCode) {
        const cleanCode = originalCode
            .replace(/\/\*[\s\S]*?\*\//g, '')
            .replace(/\/\/.*$/gm, '')
            .replace(/(['"`])((?:(?!\1)[^\\]|\\.)*)(\1)/g, '');

        let htmlScore = 0;
        let cssScore = 0;
        let jsScore = 0;

        // HTML Detection
        if (/<html\b/i.test(cleanCode)) htmlScore += 10;
        if (/<body\b/i.test(cleanCode)) htmlScore += 8;
        if (/<head\b/i.test(cleanCode)) htmlScore += 6;
        if (/<script\b[^>]*>(?!\s*<\/script>)/i.test(cleanCode)) htmlScore += 7;
        if (/<style\b[^>]*>(?!\s*<\/style>)/i.test(cleanCode)) htmlScore += 5;
        if (/<div\b|<span\b|<p\b|<h[1-6]\b/i.test(cleanCode)) htmlScore += 3;
        if (/<[^>]+>/g.test(cleanCode)) htmlScore += 2;
        if (/<title\b/i.test(cleanCode)) htmlScore += 4;
        if (/<meta\b/i.test(cleanCode)) htmlScore += 4;
        if (/<link\b/i.test(cleanCode)) htmlScore += 4;
        if (/<img\b|<a\b|<table\b/i.test(cleanCode)) htmlScore += 2;

        // CSS Detection
        if (/@import\b|@media\b|@keyframes\b|@font-face\b|@supports\b/i.test(cleanCode)) cssScore += 10;
        if (/^[^{]*\{[^}]*\}/m.test(cleanCode)) cssScore += 8;
        const cssBlocks = cleanCode.match(/^[^\n{]*\{[\s\S]*?\}/gm) || [];
        cssScore += Math.min(cssBlocks.length * 2, 12);
        if (/\b(color|background|margin|padding|display|position|width|height|font|text|border|outline|box-shadow|transform|transition|animation)\s*:/i.test(cleanCode)) cssScore += 5;
        if (/\b(top|left|right|bottom|z-index|opacity|visibility|cursor|overflow|float|clear|display:flex|grid)\s*:/i.test(cleanCode)) cssScore += 4;
        if (/\b(url\(|rgba?\(|hsla?\(|calc\(|var\(--)/i.test(cleanCode)) cssScore += 3;
        if (/::?[\w-]+/g.test(cleanCode)) cssScore += 2;
        if (/#\w+\s*\{|\.[\w-]+\s*\{/g.test(cleanCode)) cssScore += 3;

        // JavaScript Detection
        if (/(function\s+\w+|const\s+\w+|let\s+\w+|var\s+\w+|=>|class\s+\w+)/i.test(cleanCode)) jsScore += 10;
        if (/(if\s*\(|for\s*\(|while\s*\(|switch\s*\(|try\s*\{|catch\s*\(|finally\s*\{|do\s*\{|else\s*\{)/i.test(cleanCode)) jsScore += 8;
        if (/\b(return|break|continue|throw|new\s+\w+|typeof|instanceof|delete|void)\b/i.test(cleanCode)) jsScore += 7;
        if (/\b(document|window|console|navigator|location|history|localStorage|sessionStorage|alert|confirm|prompt|setTimeout|setInterval|clearTimeout|clearInterval|fetch|XMLHttpRequest|Promise|async|await|addEventListener|removeEventListener)\b/i.test(cleanCode)) jsScore += 6;
        if (/\bexport\b|\bimport\b\s+.*from|\bfrom\s+'|from\s+"/i.test(cleanCode)) jsScore += 12;
        if (/\[(?:[^[\]]|\[[^\]]*\])*\]/g.test(cleanCode)) jsScore += 2;
        if (/\{(?:[^{}]|{[^}]*})*\}/g.test(cleanCode) && !cssBlocks.length) jsScore += 2;
        if (/\b(Math\.|Date\.|JSON\.|Array\.|String\.|Number\.|Boolean\.|RegExp\.|Error\.|Symbol\.|BigInt\.)/i.test(cleanCode)) jsScore += 3;
        if (/\b(this|super|yield|debugger)\b/i.test(cleanCode)) jsScore += 4;

        // Context-based adjustments
        const hasHtmlTag = /<\/?[a-z][a-z0-9]*(\s[^>]*)?>/i.test(cleanCode);
        const hasJsKeyword = /(function|var|let|const|=>|return|if\s*\(|for\s*\(|while\s*\(|switch\s*\(|try|catch|finally|do|else|class|import|export)/i.test(cleanCode);
        
        if (!hasHtmlTag && !hasJsKeyword && cssScore > 0) {
            cssScore += 15; // Likely pure CSS
        }
        
        if (hasHtmlTag && hasJsKeyword && jsScore > 0) {
            jsScore += 5; // Likely HTML with JS
        }

        // Calculate final scores
        const maxScore = Math.max(htmlScore, cssScore, jsScore);
        let isHTML = false, isCSS = false, isJS = false;

        if (maxScore === cssScore && cssScore >= 8) {
            isCSS = true;
        } else if (maxScore === htmlScore && htmlScore >= 6) {
            isHTML = true;
        } else {
            isJS = true;
        }

        let ext = 'js';
        if (isCSS) ext='css';
        if (isHTML) ext='html';

        const blob = new Blob([code], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        const uniqueFileName = `protected_${Date.now()}.${ext}`;
        a.href = url;
        a.download = uniqueFileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        if(ext==='js'){
            const scriptTag = `<script src="${uniqueFileName}"><\/script>`;
            navigator.clipboard.writeText(scriptTag)
                .then(()=>updateStatus('Downloaded & script tag copied!', 'success'))
                .catch(()=>updateStatus('Downloaded but failed to copy tag', 'error'));
        } else {
            updateStatus('Downloaded your protected file!', 'success');
        }
    } else {
        // Fallback: detect from current code (for cases where original code is not available)
        const txt = code;
        const isHTML = /_styles|_bodyHTML|_inline/.test(txt);
        const isCSS  = /cssStyles=`/.test(txt) && !isHTML;
        const isJS   = !isHTML && !isCSS; // If not HTML or CSS, it's JS

        let ext = 'js';
        if (isCSS) ext='css';
        if (isHTML) ext='html';

        const blob = new Blob([code], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        const uniqueFileName = `protected_${Date.now()}.${ext}`;
        a.href = url;
        a.download = uniqueFileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        if(ext==='js'){
            const scriptTag = `<script src="${uniqueFileName}"><\/script>`;
            navigator.clipboard.writeText(scriptTag)
                .then(()=>updateStatus('Downloaded & script tag copied!', 'success'))
                .catch(()=>updateStatus('Downloaded but failed to copy tag', 'error'));
        } else {
            updateStatus('Downloaded your protected file!', 'success');
        }
    }
}

fileInput.addEventListener('change', handleFileUpload);

function handleFileUpload(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = e => {
            editor.setValue(e.target.result, -1);
            try { localStorage.setItem("savedCode", e.target.result); } catch(e){}
            updateStatus('File uploaded successfully!', 'success');
            detectContentType(); // detect after load
        };
        reader.readAsText(file);
    }
}

function clearCode() {
    editor.setValue('');
    try { localStorage.removeItem("savedCode"); } catch(e){}
    updateStatus('Editor cleared!', 'info');
}

function updateStatus(message, type) {
    const statusElement = document.getElementById('statusMessage');
    statusElement.textContent = message;
    statusElement.className = 'status ' + type;
    statusElement.style.transform = 'scale(1.05)';
    setTimeout(() => statusElement.style.transform = 'scale(1)', 200);
    setTimeout(() => {
        statusElement.textContent = 'Ready to obfuscate / protect your code.';
        statusElement.className = 'status';
    }, 3000);
}
</script>



</body>
</html>